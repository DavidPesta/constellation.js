define(["lib/underscore","lib/backbone","lib/constellation","mod/grid-model","mod/grid-selection-model"],function(e,t,n,r,i){var s=t.Model.extend({ALERT:"alert",nodeOpsEnabled:function(){return i.type===r.types.NODE},newGrid:function(){i.deselectAll(!0),r.newGrid()},loadGrid:function(e){i.deselectAll(!0),r.loadGrid(parseInt(e,10))},saveGrid:function(){r.saveGrid()},joinNodes:function(){this.nodeOpsEnabled()?r.joinNodes(i.items):this.alert("Please select two or more nodes.")},splitNodes:function(){this.nodeOpsEnabled()?r.splitNodes(i.items):this.alert("Please select two or more nodes.")},makePolygon:function(){this.nodeOpsEnabled()?r.addPolygon(i.items):this.alert("Please select two or more nodes.")},deleteGeometry:function(){this.nodeOpsEnabled()?r.removeNodes(i.items):r.removePolygons(i.items),i.deselectAll()},runPathfinder:function(){if(this.nodeOpsEnabled()&&i.selectionSize()===2){var t=r.findPath(i.items[0],i.items[1]);t.valid&&i.selectPath(e.pluck(t.nodes,"id"))}else this.alert("Please select exactly two nodes.")},snapNodeToGrid:function(){if(this.nodeOpsEnabled()&&i.selectionSize()===1){var e=r.getNodeById(i.items[0]),t=r.snapPointToGrid(e);e.x=t.x,e.y=t.y,r.update()}else this.alert("Please select exactly one node.")},selectNearestGridNode:function(){if(this.nodeOpsEnabled()&&i.selectionSize()===1){var e=r.getNearestNodeToNode(i.items[0]);i.select(e.id)}else this.alert("Please select exactly one node.")},hitTestNodeInPolygons:function(){if(i.selectionSize()===1){var e;if(this.nodeOpsEnabled()){var t=r.getNodeById(i.items[0]);e=r.getPolygonHitsForPoint(t)}else e=r.getNodesInPolygon(i.items[0]);e&&e.length&&i.setSelection(e)}else this.alert("Please select exactly one node.")},alert:function(e){this.trigger(this.ALERT,e)}});return new s})